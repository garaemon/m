<!-- m-view.html -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<dom-module id="m-view">
    <template>
        <style>
         :root {
             margin: 0 auto;
             padding-left: 45px;
             padding-right: 45px;
             padding-top: 45px;
         }

         header h1 {
             font-size: 20px;
             font-weight: 100;
             margin: 0;
             padding: 0;
         }

         .toc {
             margin-bottom: 20px;
             border-bottom: 1px solid #ddd;
         }
         .toc.invisible {
             display: none;
         }
         .toc.visible {
             display: block;
         }

         .toc h2 {
             border-bottom: 1px solid #eee;
         }
         .markdown-content {
             box-sizing: border-box;
             margin: 0 auto;
         }

        </style>
        <div class="container">
            <header>
                <h1 id="title">
                    <span id="title-word">{{file}}</span>
                    <paper-menu-button>
                        <paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
                        <paper-menu class="dropdown-content"
                                    on-iron-select="_menuSelected">
                            <template is="dom-if" if="{{show_toc}}">
                                <paper-item action="toggle_toc">
                                    Hide Table of Contents
                                </paper-item>
                            </template>
                            <template is="dom-if" if="{{!show_toc}}">
                                <paper-item action="toggle_toc">
                                    Show Table of Contents
                                </paper-item>
                            </template>
                            <paper-item action="copy_path">
                                Copy path to clipboard
                            </paper-item>
                        </paper-menu>
                    </paper-menu-button>

                </h1>
                <paper-tooltip position="top" for="title-word">
                    {{fullpath}}
                </paper-tooltip>
            </header>
            <section>
                <div class="toc" id="toc">
                    <h2>
                        Table of contents
                    </h2>
                    <div class="markdown-body" id="markdown-toc">
                    </div>
                </div>
                <div class="markdown-body" id="markdown-content">
                </div>
            </section>
            <footer>
            </footer>
        </div>
    </template>
    <script>
     Polymer({
         is: "m-view",
         properties: {
             file: String,
             filename_fullpath: String,
             show_toc: {
                 type: Boolean,
                 value: true
             },
         },

         _hasFile: function() {
             return !this.file;
         },

         _menuSelected: function(e) {
             var selectedItem = e.target.selectedItem;
             if (selectedItem) {
                 if (selectedItem.getAttribute('action') == 'copy_path') {
                     this._copyPathToClipBoard();
                 }
                 if (selectedItem.getAttribute('action') == 'toggle_toc') {
                     this._toggleTOC();
                 }
             }
         },

         _toggleTOC: function() {
             this.show_toc = !this.show_toc;
             if (this.show_toc) {
                 this.$.toc.classList.add('visible');
                 this.$.toc.classList.remove('invisible');
             } else {
                 this.$.toc.classList.remove('visible');
                 this.$.toc.classList.add('invisible');
             }
         },

         _copyPathToClipBoard: function() {
             console.log(this.fullpath);
             electron.ipcRenderer.send('copy-to-clipboard', this.fullpath);
             //electron.remote.require('electron').clipboard.writeText(this.fullpath);
         },

         setMarkdownHTML: function(content) {
             document.getElementById('markdown-content').innerHTML = content;
         },

         setTOCHTML: function(toc) {
             document.getElementById('markdown-toc').innerHTML = toc;
         },
     });
    </script>
</dom-module>
